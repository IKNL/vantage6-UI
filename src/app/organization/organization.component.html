<div *ngIf="userPermission.hasPermission('view', 'organization', 'global') || userPermission.hasPermission('view', 'organization', 'collaboration')">
  <mat-card>
    Select organization:
    <div class="inline">
      <div ngbDropdown class="d-inline-block">
        <button class="btn btn-dropdown" id="dropdownOrgs" ngbDropdownToggle>{{current_organization.name}}</button>
        <div ngbDropdownMenu aria-labelledby="dropdownOrgs">
          <div *ngFor="let org of organizations">
            <button ngbDropdownItem (click)="selectOrganizationDropdown(org.id)">{{org.name}}</button>
          </div>
        </div>
      </div>
    </div>
  </mat-card>
</div>
<div *ngIf="current_organization.id!==-1">
  <div class="row justify-content-md-center">
    <div class="col-lg">
      <mat-card>
        <h3>{{current_organization.name}}</h3>
        <address>
          {{current_organization.address1}}<br/>
          {{current_organization.address2}}<br/>
          {{current_organization.country}}<br/>
          {{current_organization.domain}}
        </address>
        <br/>
        <!-- TODO show button with 'show public key' or so to display public key
        {{current_organization.public_key}}
        <br/>
        -->
        <button *ngIf="userPermission.can('edit', 'organization', current_organization.id)" mat-button class="btn-edit">
          Edit
        </button>
      </mat-card>

      <mat-card>
        <h4>Roles</h4>
        <div *ngIf="userPermission.can('create', 'role', current_organization.id)" class="inline">
          <button mat-button class="btn-add btn-right" (click)="createRole()">
            <mat-icon>add_circle</mat-icon>
            <span>New role</span>
          </button>
        </div>
        <div *ngIf="current_org_role_count===0">
          <div *ngIf="userPermission.can('view', 'role', current_organization.id); else noRolesBlock">
            You do not have permission to view the roles!
          </div>
          <ng-template #noRolesBlock>
            This organization has no roles!
          </ng-template>
        </div>
        <div *ngFor="let role of roles; let idx = index">
          <div *ngIf="(role.organization_id === current_organization.id) ||
                      (role.organization_id === null && current_organization.id === 1)">
            <app-role-view
              [role]="role"
            ></app-role-view>
          </div>
        </div>
      </mat-card>
    </div>

    <div class="col-lg">
      <mat-card>
        <h4>Users</h4>
        <div *ngIf="userPermission.can('create', 'user', current_organization.id)" class="inline">
          <button mat-button class="btn-add btn-right" (click)="createUser()">
            <mat-icon>add_circle</mat-icon>
            <span>New user</span>
          </button>
        </div>
        <div *ngIf="organization_users.length===0">
          <div *ngIf="userPermission.can('view', 'user', current_organization.id); else noUsersBlock">
            <!-- TODO this message is displayed wrongly when organization has no users -->
            You do not have permission to view the users!
          </div>
          <ng-template #noUsersBlock>
            This organization has no users!
          </ng-template>
        </div>
        <div *ngFor="let user of organization_users; let idx = index">
          <app-user-view
            [user]="user"
            (deletingUser)="deleteUser(user)"
            (editingUser)="editUser(user)"
          ></app-user-view>
        </div>
      </mat-card>
    </div>
  </div>
</div>